# openapi.yaml
openapi: 3.1.0
info:
  title: Fake Stack Overflow API
  version: 1.0.0
  description: OpenAPI 3.1 specification for the Fake Stack Overflow backend server.
servers:
  - url: /api
    description: The API server endpoint
paths:
  # --------------------
  # QUESTION CONTROLLER
  # --------------------
  /question/getQuestion:
    get:
      tags:
        - Questions
      summary: Retrieve questions filtered by order, search, and asker.
      parameters:
        - in: query
          name: order
          schema:
            $ref: '#/components/schemas/OrderType'
          required: true
          description: The order in which to sort the questions.
        - in: query
          name: search
          schema:
            type: string
            default: ''
          required: false
          allowEmptyValue: true
          allowReserved: true # removes the requirement that search parameter should be URL encoded.
          description: Search string for questions, can include tags or keywords.
        - in: query
          name: askedBy
          schema:
            type: string
          required: false
          description: Username of the user who asked the question.
      responses:
        '200':
          description: Successfully retrieved filtered list of questions.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedQuestion'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/getQuestionById/{qid}:
    get:
      tags:
        - Questions
      summary: Retrieve a single question by its ID, incrementing its view count.
      parameters:
        - in: path
          name: qid
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the question.
        - in: query
          name: username
          schema:
            type: string
          required: true
          description: The username of the viewer to track views.
      responses:
        '200':
          description: Successfully retrieved question details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedQuestion'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/addQuestion:
    post:
      tags:
        - Questions
      summary: Add a new question.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewQuestionBody'
      responses:
        '200':
          description: Question successfully added and populated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedQuestion'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/upvoteQuestion:
    post:
      tags:
        - Questions
      summary: Upvote a question.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoteBody'
      responses:
        '200':
          description: Vote successfully processed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoteResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/downvoteQuestion:
    post:
      tags:
        - Questions
      summary: Downvote a question.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoteBody'
      responses:
        '200':
          description: Vote successfully processed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoteResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/getCommunityQuestions/{communityId}:
    get:
      tags:
        - Questions
      summary: Retrieve questions for a specific community.
      parameters:
        - in: path
          name: communityId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the community.
      responses:
        '200':
          description: Successfully retrieved list of community questions.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedQuestion'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # ANSWER CONTROLLER
  # --------------------
  /answer/addAnswer:
    post:
      tags:
        - Answers
      summary: Add a new answer to a specific question.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddAnswerBody'
      responses:
        '200':
          description: Answer successfully added. Returns the database answer object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseAnswer'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # TAG CONTROLLER
  # --------------------
  /tags/getTagsWithQuestionNumber:
    get:
      tags:
        - Tags
      summary: Retrieve a list of all tags and the number of questions associated with each.
      responses:
        '200':
          description: Successfully retrieved list of tags and counts.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    name:
                      type: string
                    qcnt:
                      type: integer
                      minimum: 0
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /tags/getTagByName/{name}:
    get:
      tags:
        - Tags
      summary: Retrieve a single tag by its name.
      parameters:
        - in: path
          name: name
          schema:
            type: string
          required: true
          description: The name of the tag.
      responses:
        '200':
          description: Successfully retrieved tag details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseTag'
        '404':
          description: Tag not found.
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # COMMENT CONTROLLER
  # --------------------
  /comment/addComment:
    post:
      tags:
        - Comments
      summary: Add a new comment to a question or an answer.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddCommentBody'
      responses:
        '200':
          description: Comment successfully added. Returns the database comment object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseComment'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # MESSAGE CONTROLLER
  # --------------------
  /message/addMessage:
    post:
      tags:
        - Messages
      summary: Add a new global message.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddMessageBody'
      responses:
        '200':
          description: Message successfully added. Returns the database message object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseMessage'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /message/getMessages:
    get:
      tags:
        - Messages
      summary: Fetch all global messages.
      responses:
        '200':
          description: Successfully retrieved global messages.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DatabaseMessage'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # CHAT CONTROLLER
  # --------------------
  /chat/createChat:
    post:
      tags:
        - Chats
      summary: Create a new chat conversation.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateChatBody'
      responses:
        '200':
          description: Chat successfully created. Returns the populated chat object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedChat'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /chat/{chatId}/addMessage:
    post:
      tags:
        - Chats
      summary: Add a new message to an existing chat.
      parameters:
        - in: path
          name: chatId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the chat.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageBody'
      responses:
        '200':
          description: Message successfully added. Returns the updated populated chat object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedChat'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /chat/{chatId}:
    get:
      tags:
        - Chats
      summary: Retrieve a single chat by its ID.
      parameters:
        - in: path
          name: chatId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the chat.
      responses:
        '200':
          description: Successfully retrieved chat details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedChat'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /chat/{chatId}/addParticipant:
    post:
      tags:
        - Chats
      summary: Add a new participant to an existing chat.
      parameters:
        - in: path
          name: chatId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the chat.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddParticipantBody'
      responses:
        '200':
          description: Participant successfully added. Returns the updated database chat object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedChat'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /chat/getChatsByUser/{username}:
    get:
      tags:
        - Chats
      summary: Retrieve all chats involving a specific user.
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: The username whose chats are being retrieved.
      responses:
        '200':
          description: Successfully retrieved list of chats.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedChat'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # GAME CONTROLLER
  # --------------------
  /games/create:
    post:
      tags:
        - Games
      summary: Create a new game instance.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGameBody'
      responses:
        '200':
          description: Game successfully created. Returns the game ID (string).
          content:
            application/json:
              schema:
                type: string
                description: The ID of the newly created game.
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /games/join:
    post:
      tags:
        - Games
      summary: Join an existing game.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GameActionBody'
      responses:
        '200':
          description: Player successfully joined. Returns the updated game state.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedGame'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /games/start:
    post:
      tags:
        - Games
      summary: Start a game.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - gameID
              properties:
                gameID:
                  type: string
      responses:
        '200':
          description: Game successfully started. Returns the updated game state.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedGame'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /games/leave:
    post:
      tags:
        - Games
      summary: Leave an existing game.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GameActionBody'
      responses:
        '200':
          description: Player successfully left. Returns the updated game state.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedGame'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /games/delete:
    post:
      tags:
        - Games
      summary: Delete a game.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - gameID
              properties:
                gameID:
                  type: string
      responses:
        '200':
          description: Game successfully deleted.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /games/games:
    get:
      tags:
        - Games
      summary: Fetch a list of games, optionally filtered by type and status.
      parameters:
        - in: query
          name: gameType
          schema:
            $ref: '#/components/schemas/GameType'
          required: false
          description: Filter games by type (e.g., Trivia).
        - in: query
          name: status
          schema:
            $ref: '#/components/schemas/GameStatus'
          required: false
          description: Filter games by status.
      responses:
        '200':
          description: Successfully retrieved list of games.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedGame'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # COLLECTION CONTROLLER
  # --------------------
  /collection/create:
    post:
      tags:
        - Collections
      summary: Create a new collection.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCollectionBody'
      responses:
        '200':
          description: Collection successfully created. Returns the populated collection object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedCollection'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /collection/delete/{collectionId}:
    delete:
      tags:
        - Collections
      summary: Delete a collection by ID.
      parameters:
        - in: path
          name: collectionId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the collection to delete.
        - in: query
          name: username
          schema:
            type: string
          required: true
          description: The username of the user performing the deletion (for authorization).
      responses:
        '200':
          description: Collection successfully deleted. Returns the deleted collection object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedCollection'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /collection/toggleSaveQuestion:
    patch:
      tags:
        - Collections
      summary: Add or remove a question from a collection.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ToggleSaveQuestionBody'
      responses:
        '200':
          description: Collection successfully updated. Returns the updated populated collection object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedCollection'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /collection/getCollectionsByUsername/{username}:
    get:
      tags:
        - Collections
      summary: Retrieve all collections for a specific user, filtered by privacy.
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: The username whose collections are being viewed.
        - in: query
          name: currentUsername
          schema:
            type: string
          required: true
          description: The username of the currently logged-in user (for permission check).
      responses:
        '200':
          description: Successfully retrieved collections list.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedCollection'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /collection/getCollectionById/{collectionId}:
    get:
      tags:
        - Collections
      summary: Retrieve a single collection by ID, subject to privacy checks.
      parameters:
        - in: path
          name: collectionId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the collection.
        - in: query
          name: username
          schema:
            type: string
          required: true
          description: The username of the viewer (for permission check).
      responses:
        '200':
          description: Successfully retrieved collection details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedCollection'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # COMMUNITY CONTROLLER
  # --------------------
  /community/getCommunity/{communityId}:
    get:
      tags:
        - Communities
      summary: Retrieve a community by its ID.
      parameters:
        - in: path
          name: communityId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the community.
      responses:
        '200':
          description: Successfully retrieved community details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseCommunity'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /community/getAllCommunities:
    get:
      tags:
        - Communities
      summary: Retrieve a list of all communities.
      responses:
        '200':
          description: Successfully retrieved list of communities.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DatabaseCommunity'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /community/toggleMembership:
    post:
      tags:
        - Communities
      summary: Join or leave a community.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ToggleMembershipBody'
      responses:
        '200':
          description: Membership status successfully updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseCommunity'
        '400':
          $ref: '#/components/responses/ValidationError'
        '403':
          description: Forbidden (admin trying to leave the last admin spot).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '404':
          description: Community not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /community/create:
    post:
      tags:
        - Communities
      summary: Create a new community.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCommunityBody'
      responses:
        '200':
          description: Community successfully created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseCommunity'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /community/delete/{communityId}:
    delete:
      tags:
        - Communities
      summary: Delete a community (requires admin privileges).
      parameters:
        - in: path
          name: communityId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the community to delete.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteCommunityBody'
      responses:
        '200':
          description: Community successfully deleted.
          content:
            application/json:
              schema:
                type: object
                properties:
                  community:
                    $ref: '#/components/schemas/DatabaseCommunity'
                  message:
                    type: string
        '400':
          $ref: '#/components/responses/ValidationError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '404':
          description: Community not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # USER CONTROLLER
  # --------------------
  /user/signup:
    post:
      tags:
        - Users
      summary: Create a new user account.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserSignupBody'
      responses:
        '200':
          description: User successfully created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/login:
    post:
      tags:
        - Users
      summary: Log a user in.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLoginBody'
      responses:
        '200':
          description: User successfully logged in.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/resetPassword:
    patch:
      tags:
        - Users
      summary: Reset a user's password.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLoginBody'
      responses:
        '200':
          description: User password successfully updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/getUser/{username}:
    get:
      tags:
        - Users
      summary: Retrieve a user by username.
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: The username of the user to retrieve.
      responses:
        '200':
          description: Successfully retrieved user details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/getUsers:
    get:
      tags:
        - Users
      summary: Retrieve a list of all users.
      responses:
        '200':
          description: Successfully retrieved list of all users.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/deleteUser/{username}:
    delete:
      tags:
        - Users
      summary: Delete a user by username.
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: The username of the user to delete.
      responses:
        '200':
          description: User successfully deleted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/updateBiography:
    patch:
      tags:
        - Users
      summary: Update a user's biography.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateBiographyBody'
      responses:
        '200':
          description: User biography successfully updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/updateExternalLinks:
    patch:
      tags:
        - Users
      summary: Update a user's external links (LinkedIn, GitHub, Portfolio).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateExternalLinksBody'
      responses:
        '200':
          description: User external links successfully updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

components:
  schemas:
    # --------------------
    # CORE UTIL SCHEMAS
    # --------------------
    OrderType:
      type: string
      enum:
        - newest
        - unanswered
        - active
        - mostViewed
      default: 'newest'

    VoteResponse:
      type: object
      properties:
        msg:
          type: string
        upVotes:
          type: array
          items:
            type: string
        downVotes:
          type: array
          items:
            type: string

    # --------------------
    # QUESTION SCHEMAS
    # --------------------
    VoteBody:
      type: object
      required:
        - qid
        - username
      properties:
        qid:
          type: string
          description: Unique identifier of the question.
        username:
          type: string
          description: Username of the user casting the vote.

    TagBody:
      type: object
      required:
        - name
        - description
      properties:
        name:
          type: string
          minLength: 1
          description: The name of the tag.
        description:
          type: string
          minLength: 1
          description: A brief description of the tag's purpose or usage.

    NewQuestionBody:
      type: object
      required:
        - title
        - text
        - tags
        - askedBy
        - askDateTime
      properties:
        title:
          type: string
          minLength: 1
        text:
          type: string
          minLength: 1
        tags:
          type: array
          items:
            $ref: '#/components/schemas/TagBody'
          minItems: 1
          description: Array of Tag objects, each requiring a name and description.
        askedBy:
          type: string
          minLength: 1
        askDateTime:
          type: string
          format: date-time
        community:
          type: string
          format: object-id
          nullable: true

    PopulatedQuestion:
      type: object
      description: A fully populated question object with embedded tags, answers, and comments.

    # --------------------
    # ANSWER SCHEMAS
    # --------------------
    AnswerBody:
      type: object
      required:
        - text
        - ansBy
        - ansDateTime
      properties:
        text:
          type: string
          minLength: 1
        ansBy:
          type: string
          minLength: 1
        ansDateTime:
          type: string
          format: date-time

    AddAnswerBody:
      type: object
      required:
        - qid
        - ans
      properties:
        qid:
          type: string
          format: object-id
          description: The ID of the question the answer belongs to.
        ans:
          $ref: '#/components/schemas/AnswerBody'

    DatabaseAnswer:
      type: object
      description: An answer object as stored in the database.

    # --------------------
    # TAG SCHEMAS
    # --------------------
    DatabaseTag:
      type: object
      description: A tag object as stored in the database.

    # --------------------
    # COMMENT SCHEMAS
    # --------------------
    CommentBody:
      type: object
      required:
        - text
        - commentBy
        - commentDateTime
      properties:
        text:
          type: string
          minLength: 1
        commentBy:
          type: string
          minLength: 1
        commentDateTime:
          type: string
          format: date-time

    AddCommentBody:
      type: object
      required:
        - id
        - type
        - comment
      properties:
        id:
          type: string
          format: object-id
          description: The ID of the parent (question or answer).
        type:
          type: string
          enum:
            - question
            - answer
          description: The type of document the comment is attached to.
        comment:
          $ref: '#/components/schemas/CommentBody'

    DatabaseComment:
      type: object
      description: A comment object as stored in the database.

    # --------------------
    # MESSAGE SCHEMAS
    # --------------------
    MessageBody:
      type: object
      required:
        - msg
        - msgFrom
        - msgDateTime
      properties:
        msg:
          type: string
          minLength: 1
        msgFrom:
          type: string
          minLength: 1
        msgDateTime:
          type: string
          format: date-time

    AddMessageBody:
      type: object
      required:
        - messageToAdd
      properties:
        messageToAdd:
          $ref: '#/components/schemas/MessageBody'

    DatabaseMessage:
      type: object
      description: A message object as stored in the database.

    # --------------------
    # CHAT SCHEMAS
    # --------------------
    CreateChatBody:
      type: object
      required:
        - participants
        - messages
      properties:
        participants:
          type: array
          minItems: 1
          items:
            type: string
        messages:
          type: array
          items:
            $ref: '#/components/schemas/MessageBody'

    AddParticipantBody:
      type: object
      required:
        - username
      properties:
        username:
          type: string
          description: The username of the new participant.

    PopulatedChat:
      type: object
      description: A fully populated chat object with embedded messages.

    # --------------------
    # GAME SCHEMAS
    # --------------------
    GameType:
      type: string
      enum: # Based on known game types
        - Trivia
      description: The type of game to create.

    GameStatus:
      type: string
      enum:
        - WAITING_TO_START
        - IN_PROGRESS
        - OVER
      description: The status of the game.

    CreateGameBody:
      type: object
      required:
        - gameType
      properties:
        gameType:
          $ref: '#/components/schemas/GameType'

    GameActionBody:
      type: object
      required:
        - gameID
        - playerID
      properties:
        gameID:
          type: string
        playerID:
          type: string

    PopulatedGame:
      type: object
      description: A fully populated game instance object.

    # --------------------
    # COLLECTION SCHEMAS
    # --------------------
    CreateCollectionBody:
      type: object
      required:
        - name
        - description
        - questions
        - username
      properties:
        name:
          type: string
          minLength: 1
        description:
          type: string
          minLength: 1
        questions:
          type: array
          items:
            type: string
            format: object-id
        username:
          type: string
          minLength: 1
        isPrivate:
          type: boolean
          default: false

    ToggleSaveQuestionBody:
      type: object
      required:
        - collectionId
        - questionId
        - username
      properties:
        collectionId:
          type: string
          format: object-id
        questionId:
          type: string
          format: object-id
        username:
          type: string

    PopulatedCollection:
      type: object
      description: A fully populated collection object.

    # --------------------
    # COMMUNITY SCHEMAS
    # --------------------
    CommunityVisibility:
      type: string
      enum:
        - PUBLIC
        - PRIVATE

    ToggleMembershipBody:
      type: object
      required:
        - communityId
        - username
      properties:
        communityId:
          type: string
          format: object-id
        username:
          type: string

    CreateCommunityBody:
      type: object
      required:
        - name
        - description
        - admin
      properties:
        name:
          type: string
          minLength: 1
        description:
          type: string
          minLength: 1
        admin:
          type: string
          minLength: 1
        visibility:
          $ref: '#/components/schemas/CommunityVisibility'
          default: PUBLIC
        participants:
          type: array
          items:
            type: string
          default: []

    DeleteCommunityBody:
      type: object
      required:
        - username
      properties:
        username:
          type: string
          minLength: 1
          description: The username of the admin performing the deletion.

    DatabaseCommunity:
      type: object
      description: A community object as stored in the database.

    # --------------------
    # USER SCHEMAS
    # --------------------
    UserSignupBody:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          minLength: 1
        password:
          type: string
          minLength: 1
        email:
          type: string
          format: email
          nullable: true
          description: Optional user email.
        biography:
          type: string
          default: ''
          description: Optional user biography.

    UserLoginBody:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          minLength: 1
        password:
          type: string
          minLength: 1

    UpdateBiographyBody:
      type: object
      required:
        - username
        - biography
      properties:
        username:
          type: string
          minLength: 1
        biography:
          type: string

    UpdateExternalLinksBody:
      type: object
      required:
        - username
        - externalLinks
      properties:
        username:
          type: string
          minLength: 1
        externalLinks:
          type: object
          properties:
            linkedin:
              type: string
              format: uri
            github:
              type: string
              format: uri
            portfolio:
              type: string
              format: uri

    User:
      type: object
      description: A user profile object.

    SimpleErrorBody: # MODIFICATION: New schema for simple JSON errors like 403, 404
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: A detailed error message.

  responses:
    # --------------------
    # RESPONSE SCHEMAS
    # --------------------
    ErrorResponse:
      description: Internal Server Error
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                description: The error message returned by the server.
    ValidationError:
      description: Bad Request / Validation Error
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                description: The error message from express-openapi-validator.
              errors:
                type: array
                description: Detailed list of validation errors.